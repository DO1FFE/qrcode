{% extends 'base.html' %}
{% block content %}
<h1>QR-Code Generator</h1>
{% if not current_user.is_authenticated %}
<div class="alert alert-info">
    Bitte <a href="{{ url_for('login') }}">einloggen</a>, um QR-Codes zu erstellen und Vorschauen anzuzeigen.
</div>
{% endif %}
<form method="post" class="row g-3 mb-4">
  <div class="col-md-6">
    <label class="form-label">URL</label>
    <input type="text" class="form-control" name="url" required>
  </div>
  <div class="col-md-2">
    <label class="form-label">Farbe</label>
    <input type="color" class="form-control form-control-color" name="color" value="#000000">
  </div>
  <div class="col-md-2">
    <label class="form-label">Hintergrund</label>
    <input type="color" class="form-control form-control-color" name="bgcolor" value="#ffffff">
  </div>
  <div class="col-md-12">
    <label class="form-label">Beschreibung</label>
    <input type="text" class="form-control" name="description">
  </div>
  <div class="col-md-12 form-check">
    <input class="form-check-input" type="checkbox" name="rounded" id="rounded">
    <label class="form-check-label" for="rounded">Runde Ecken</label>
  </div>
  <div class="col-12">
    <button type="submit" class="btn btn-primary" {% if limit_reached %}disabled{% endif %}>Erstellen</button>
  </div>
  {% if remaining is not none and limit is not none %}
  <div class="col-12">
    <small class="text-muted">Du kannst noch {{ remaining }} von {{ limit }} QR-Codes erstellen.</small>
  </div>
  {% elif limit is none and current_user.is_authenticated %}
  <div class="col-12">
    <small class="text-muted">Unbegrenzte QR-Codes verfügbar.</small>
  </div>
  {% endif %}
</form>
{% if limit_reached %}
<div class="alert alert-warning">Limit erreicht. <a href="{{ url_for('upgrade') }}">Upgrade</a> notwendig.</div>
{% endif %}

{% if qrcodes %}
<h2>Meine QR-Codes</h2>
<div class="row row-cols-1 row-cols-md-3 g-4">
  {% for qr in qrcodes %}
  <div class="col">
    <div class="card h-100">
      <img src="{{ url_for('preview', qr_id=qr.id) }}" class="card-img-top qr-preview" alt="QR-Code">
      <div class="card-body">
        <h5 class="card-title">{{ qr.description or 'QR Code' }}</h5>
        <p class="card-text"><a href="{{ qr.url }}" target="_blank">{{ qr.url }}</a></p>
        <p class="card-text"><small class="text-muted">{{ qr.created_at_local.strftime('%d.%m.%Y %H:%M') }}</small></p>
        <div class="btn-group" role="group">
          <a href="{{ url_for('download', qr_id=qr.id, fmt='png') }}" class="btn btn-outline-light download-btn">PNG</a>
          <a href="{{ url_for('download', qr_id=qr.id, fmt='jpg') }}" class="btn btn-outline-light download-btn">JPG</a>
          <a href="{{ url_for('download', qr_id=qr.id, fmt='svg') }}" class="btn btn-outline-light download-btn">SVG</a>
        </div>
        <form method="post" action="{{ url_for('delete', qr_id=qr.id) }}" class="mt-2" onsubmit="return confirm('Löschen?');">
          <button class="btn btn-danger btn-sm">Löschen</button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

{% endblock %}
